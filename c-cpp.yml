name: C/C++ CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  Ubuntu:
    name: Ubuntu Latest
    runs-on: ubuntu-latest
    steps:
    - name: install dependencies
      run: |
        sudo add-apt-repository -y "deb http://archive.ubuntu.com/ubuntu `lsb_release -sc` main universe restricted multiverse"
        sudo apt-get update -y -qq
        sudo apt-get install libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev libegl1-mesa-dev libgles2-mesa-dev libsdl2-net-dev
    - uses: actions/checkout@v2
    - name: make
      run: make -j
    - name: make tests
      run: make tests
    - name: run tests
      run: build/tests
  Windows:
    name: Windows
    runs-on: windows-2020
    steps:
      - name: Setup MSYS2
        uses: msys2/setup-msys2@v2
        with:
          install: zip mingw-w64-x86_64-SDL2 mingw-w64-x86_64-SDL2_net mingw-w64-x86_64-clang mingw-w64-x86_64-glbinding mingw-w64-x86_64-glew make
      - uses: actions/checkout@v2
      - name: make
        run: make -j
      - name: make tests
        run: make tests
      - name: run tests
        run: build/tests
  macOS:
    name: macOS
    runs-on: macOS-latest
    steps:
      - name: install dependencies
        run: |
          wget -q "https://www.libsdl.org/projects/SDL_net/release/SDL2_net-2.0.1.dmg"
          hdiutil attach SDL2_net-2.0.1.dmg
          sudo cp -R /Volumes/SDL2_net/SDL2_net.framework /Library/Frameworks/
          wget -q "http://libsdl.org/release/SDL2-2.0.12.dmg"
          hdiutil attach SDL2-2.0.12.dmg
          sudo cp -R /Volumes/SDL2/SDL2.framework /Library/Frameworks/
      - name: make
        run: make -j macapp SIGNING_ID=NONE
      - name: make tests
        run: make tests
      - name: run tests
        run: build/tests
